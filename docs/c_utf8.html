<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" SYSTEM "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<title>UTF-8 String Handling API  - Legato Docs</title>
<meta content="legatoâ„¢ is an open source Linux-based embedded platform designed to simplify connected IoT application development" name="description" />
<meta content="#keywords" name="keywords" />
<meta content="noindex, nofollow" name="robots" />
<meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
<link href="/resources/images/legato.ico" rel="shortcut icon" />
<link href="/resources/images/legato.ico" rel="icon" type="image/x-icon" />
<link href="/resources/images/legato.ico" rel="shortcut icon" type="image/x-icon" />
<link href="#" rel="apple-touch-icon" />
<link href="#" rel="apple-touch-icon" sizes="72x72" />
<link href="#" rel="apple-touch-icon" sizes="114x114" />
<link href="/resources/css/style.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/resources/css/font-awesome.css" rel="stylesheet" type="text/css" />
<!--[if IE]>
        <script src="/resources/js/html5shiv.js"></script>
        <script src="/resources/js/respond.js"></script>
        <![endif]-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
<script src="/resources/js/main.js"></script>
<link href="/resources/css/jqtree.css" rel="stylesheet" type="text/css" />
<script src="/resources/js/tree.jquery.js" type="text/javascript"></script>
<script src="/resources/js/jquery.cookie.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script>
        setupTree("/resources/tocs/Build Apps Documentation.json");
        </script>
</head>
<body>
<div class="wrapper">
<div class="fa fa-bars documentation" id="menu-trigger"></div>
<div id="top">
<header>
<nav>
<a class="navlink" href="/index.html">Introduction</a><a class="navlink" href="/docs/getstarted_main.html">Build Apps</a><a class="subnavlink" href="/docs/getstarted_main.html">Get started</a><a class="subnavlink" href="/docs/build_apps_documentation.html">Documentation</a><a class="subnavlink" href="/docs/files.html">Reference</a><a class="navlink" href="/docs/platform_constraints.html">Build Platform</a><a class="subnavlink" href="/docs/platform_constraints.html">Platform Constraints</a><a class="subnavlink" href="/docs/yocto_main.html">Yocto Info</a><a class="navlink" href="/docs/about_main.html">About</a>
</nav>
</header>
</div>
<div class="orange" id="menudocumentation">
<header>
<h1><a class="navlink" href="/" title="back to Legato homepage">Legato</a></h1>
<h2>/ Build Apps</h2>
<nav class="ui-front" id="searchresult">
<i class="fa fa-search"></i>
<input id="autocomplete" onkeyup="getdata('Build Apps')" placeholder="Search..." /> <!-- <input id="category" type="checkbox" onclick="checkbox()"> <label for="category">API Search</label> -->
</nav>
</header>
</div>
<div class="orange" id="topMenu">
<nav>
<a href="getstarted_main.html">Get Started</a><a class="link-selected" href="build_apps_documentation.html">Documentation</a><a href="files.html">Reference</a>
</nav>
</div>
<div id="left">
<div id="tree1"></div>
</div>
<div class="content">
<div class="header">
<div class="headertitle">
<h1 class="title">UTF-8 String Handling API </h1> </div>
</div><div class="contents">
<div class="textblock"><p><a class="el" href="le__utf8_8h.html">API Reference</a></p>
<hr />
<p>This module implements safe and easy to use string handling functions for null-terminated strings with UTF-8 encoding.</p>
<p>UTF-8 is a variable length character encoding that supports every character in the Unicode character set. UTF-8 has become the dominant character encoding because it is self synchronizing, compatible with ASCII, and avoids the endian issues that other encodings face.</p>
<h1><a class="anchor" id="utf8_encoding"></a>
UTF-8 Encoding</h1>
<p>UTF-8 uses between one and four bytes to encode a character as illustrated in the following table.</p>
<table class="doxtable">
<tr>
<th>Byte 1  </th><th>Byte 2  </th><th>Byte 3  </th><th>Byte 4   </th></tr>
<tr>
<td>0xxxxxxx  </td><td></td><td></td><td></td></tr>
<tr>
<td>110xxxxx  </td><td>10xxxxxx  </td><td></td><td></td></tr>
<tr>
<td>1110xxxx  </td><td>10xxxxxx  </td><td>10xxxxxx  </td><td></td></tr>
<tr>
<td>11110xxx  </td><td>10xxxxxx  </td><td>10xxxxxx  </td><td>10xxxxxx   </td></tr>
</table>
<p>Single byte codes are used only for the ASCII values 0 through 127. In this case, UTF-8 has the same binary value as ASCII, making ASCII text valid UTF-8 encoded Unicode. All ASCII strings are UTF-8 compatible.</p>
<p>Character codes larger than 127 have a multi-byte encoding consisting of a leading byte and one or more continuation bytes.</p>
<p>The leading byte has two or more high-order 1's followed by a 0 that can be used to determine the number bytes in the character without examining the continuation bytes.</p>
<p>The continuation bytes have '10' in the high-order position.</p>
<p>Single bytes, leading bytes and continuation bytes can't have the same values. This means that UTF-8 strings are self-synchronized, allowing the start of a character to be found by backing up at most three bytes.</p>
<h1><a class="anchor" id="utf8_copy"></a>
Copy and Append</h1>
<p><code><a class="el" href="le__utf8_8h.html#aa5ae72c01396c106fdf3b4741ead7477">le_utf8_Copy()</a></code> copies a string to a specified buffer location.</p>
<p><code><a class="el" href="le__utf8_8h.html#ade7dfb60b18574dc62c49b86c025579b">le_utf8_Append()</a></code> appends a string to the end of another string by copying the source string to the destination string's buffer starting at the null-terminator of the destination string.</p>
<p>The <code>le_uft8_CopyUpToSubStr()</code> function is like <a class="el" href="le__utf8_8h.html#aa5ae72c01396c106fdf3b4741ead7477">le_utf8_Copy()</a> except it copies only up to, but not including, a specified string.</p>
<h1><a class="anchor" id="utf8_trunc"></a>
Truncation</h1>
<p>Because UTF-8 is a variable length encoding, the number of characters in a string is not necessarily the same as the number bytes in the string. When using functions like <a class="el" href="le__utf8_8h.html#aa5ae72c01396c106fdf3b4741ead7477">le_utf8_Copy()</a> and <a class="el" href="le__utf8_8h.html#ade7dfb60b18574dc62c49b86c025579b">le_utf8_Append()</a>, the size of the destination buffer, in bytes, must be provided to avoid buffer overruns.</p>
<p>The copied string is truncated because of limited space in the destination buffer, and the destination buffer may not be completely filled. This can occur during the copy processf the last character to copy is more than one byte long and will not fit within the buffer.</p>
<p>The character is not copied and a null-terminator is added. Even though we have not filled the destination buffer,we have truncated the copied string. Essentially, functions like <a class="el" href="le__utf8_8h.html#aa5ae72c01396c106fdf3b4741ead7477">le_utf8_Copy()</a> and <a class="el" href="le__utf8_8h.html#ade7dfb60b18574dc62c49b86c025579b">le_utf8_Append()</a> only copy complete characters, not partial characters.</p>
<p>For <a class="el" href="le__utf8_8h.html#aa5ae72c01396c106fdf3b4741ead7477">le_utf8_Copy()</a>, the number of bytes actually copied is returned in the numBytesPtr parameter. This parameter can be set to NULL if the number of bytes copied is not needed. <a class="el" href="le__utf8_8h.html#ade7dfb60b18574dc62c49b86c025579b">le_utf8_Append()</a> and le_uft8_CopyUpToSubStr() work similarly.</p>
<div class="fragment"><div class="line"><span class="comment">// In this code sample, we need the number of bytes actually copied:</span></div><div class="line"><span class="keywordtype">size_t</span> numBytes;</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="le__utf8_8h.html#aa5ae72c01396c106fdf3b4741ead7477">le_utf8_Copy</a>(destStr, srcStr, <span class="keyword">sizeof</span>(destStr), &numBytes) == <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86cae42c9d785827fc3a9c47fb55baca7879">LE_OVERFLOW</a>)</div><div class="line">{</div><div class="line"> <a class="code" href="le__log_8h.html#a6e79fdd28f63d612fee5d9f42fc4df77">LE_WARN</a>(<span class="stringliteral">"'%s' was truncated when copied.  Only %d bytes were copied."</span>, srcStr, numBytes);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// In this code sample, we don't care about the number of bytes copied:</span></div><div class="line"><a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="le__utf8_8h.html#aa5ae72c01396c106fdf3b4741ead7477">le_utf8_Copy</a>(destStr, srcStr, <span class="keyword">sizeof</span>(destStr), NULL) != <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86cae42c9d785827fc3a9c47fb55baca7879">LE_OVERFLOW</a>);</div></div><!-- fragment --><h1><a class="anchor" id="utf8_length"></a>
String Lengths</h1>
<p>String length may mean either the number of characters in the string or the number of bytes in the string. These two meanings are often used interchangeably because in ASCII-only encodings the number of characters in a string is equal to the number of bytes in a string. But this is not necessarily true with variable length encodings such as UTF-8. Legato provides both a <a class="el" href="le__utf8_8h.html#af8f61f1aa523b03d02d6a89cb61449e2">le_utf8_NumChars()</a> function and a <a class="el" href="le__utf8_8h.html#a2541a26cade8cef93db889194a430008">le_utf8_NumBytes()</a> function.</p>
<p><code><a class="el" href="le__utf8_8h.html#a2541a26cade8cef93db889194a430008">le_utf8_NumBytes()</a></code> must be used when determining the memory size of a string. <code><a class="el" href="le__utf8_8h.html#af8f61f1aa523b03d02d6a89cb61449e2">le_utf8_NumChars()</a></code> is useful for counting the number of characters in a string (ie. for display purposes).</p>
<h1><a class="anchor" id="utf8_length"></a>
String Lengths</h1>
<p>The function <a class="el" href="le__utf8_8h.html#acf29bce77181131dc39b6ff2101b817c">le_utf8_NumBytesInChar()</a> can be used to determine the number of bytes in a character by looking at its first byte. This is handy when reading a UTF-8 string from an input stream. When the first byte is read, it can be passed to <a class="el" href="le__utf8_8h.html#acf29bce77181131dc39b6ff2101b817c">le_utf8_NumBytesInChar()</a> to determine how many more bytes need to be read to get the rest of the character.</p>
<h1><a class="anchor" id="utf8_format"></a>
Checking UTF-8 Format</h1>
<p>As can be seen in the <a class="el" href="c_utf8.html#utf8_encoding">UTF-8 Encoding</a> section, UTF-8 strings have a specific byte sequence. The <code><a class="el" href="le__utf8_8h.html#acffd959e1c6dcf9841217c1c0f6d09e5">le_utf8_IsFormatCorrect()</a></code> function can be used to check if a string conforms to UTF-8 encoding. Not all valid UTF-8 characters are valid for a given character set; <a class="el" href="le__utf8_8h.html#acffd959e1c6dcf9841217c1c0f6d09e5">le_utf8_IsFormatCorrect()</a> does not check for this.</p>
<h1><a class="anchor" id="utf8_parsing"></a>
String Parsing</h1>
<p>To assist with converting integer values from UTF-8 strings to binary numerical values, <a class="el" href="le__utf8_8h.html#a680a92fafea1ed72dedb80b52be32a06">le_utf8_ParseInt()</a> is provided.</p>
<p>More parsing functions may be added as required in the future.</p>
<hr />
<p class="copyright">Copyright (C) Sierra Wireless Inc. Use of this work is subject to license. </p>
</div></div>
<br clear="left" />
</div>
<div id="footer">
</div>
</div>
</body>
</html>